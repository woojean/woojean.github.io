I">µ<ul id="markdown-toc">
  <li><a href="#getting-started-with-mongodb-mongodb-shell-edition" id="markdown-toc-getting-started-with-mongodb-mongodb-shell-edition">Getting Started with MongoDB (MongoDB Shell Edition)</a>    <ul>
      <li><a href="#introduction-to-mongodb" id="markdown-toc-introduction-to-mongodb">Introduction to MongoDB</a></li>
      <li><a href="#install-mongodb" id="markdown-toc-install-mongodb">Install MongoDB</a></li>
      <li><a href="#mongodb-shell-mongo" id="markdown-toc-mongodb-shell-mongo">MongoDB Shell (mongo)</a></li>
      <li><a href="#insert-data-with-the-mongo-shell" id="markdown-toc-insert-data-with-the-mongo-shell">Insert Data with the mongo Shell</a></li>
      <li><a href="#find-or-query-data-with-the-mongo-shell" id="markdown-toc-find-or-query-data-with-the-mongo-shell">Find or Query Data with the mongo Shell</a></li>
      <li><a href="#update-data-with-the-mongo-shell" id="markdown-toc-update-data-with-the-mongo-shell">Update Data with the mongo Shell</a></li>
      <li><a href="#remove-data-with-the-mongo-shell" id="markdown-toc-remove-data-with-the-mongo-shell">Remove Data with the mongo Shell</a></li>
      <li><a href="#data-aggregation-with-the-mongo-shell" id="markdown-toc-data-aggregation-with-the-mongo-shell">Data Aggregation with the mongo Shell</a></li>
      <li><a href="#indexes-with-the-mongo-shell" id="markdown-toc-indexes-with-the-mongo-shell">Indexes with the mongo Shell</a></li>
      <li><a href="#drivers" id="markdown-toc-drivers">Drivers</a></li>
    </ul>
  </li>
  <li><a href="#introduction-to-mongodb-1" id="markdown-toc-introduction-to-mongodb-1">Introduction to MongoDB</a>    <ul>
      <li><a href="#databases-and-collections" id="markdown-toc-databases-and-collections">Databases and Collections</a>        <ul>
          <li><a href="#views" id="markdown-toc-views">Views</a></li>
          <li><a href="#capped-collections" id="markdown-toc-capped-collections">Capped Collections</a></li>
        </ul>
      </li>
      <li><a href="#documents" id="markdown-toc-documents">Documents</a></li>
      <li><a href="#bson-types" id="markdown-toc-bson-types">BSON Types</a></li>
      <li><a href="#comparisonsort-order" id="markdown-toc-comparisonsort-order">Comparison/Sort Order</a></li>
      <li><a href="#mongodb-extended-json" id="markdown-toc-mongodb-extended-json">MongoDB Extended JSON</a></li>
    </ul>
  </li>
  <li><a href="#install-mongodb-1" id="markdown-toc-install-mongodb-1">Install MongoDB</a></li>
  <li><a href="#the-mongo-shell" id="markdown-toc-the-mongo-shell">The Mongo Shell</a>    <ul>
      <li><a href="#configure-the-mongo-shell" id="markdown-toc-configure-the-mongo-shell">Configure the mongo Shell</a></li>
      <li><a href="#access-the-mongo-shell-help" id="markdown-toc-access-the-mongo-shell-help">Access the mongo Shell Help</a></li>
      <li><a href="#write-scripts-for-the-mongo-shell" id="markdown-toc-write-scripts-for-the-mongo-shell">Write Scripts for the mongo Shell</a></li>
      <li><a href="#data-types-in-the-mongo-shell" id="markdown-toc-data-types-in-the-mongo-shell">Data Types in the mongo Shell</a></li>
      <li><a href="#mongo-shell-quick-reference" id="markdown-toc-mongo-shell-quick-reference">mongo Shell Quick Reference</a></li>
    </ul>
  </li>
  <li><a href="#mongodb-crud-operations" id="markdown-toc-mongodb-crud-operations">MongoDB CRUD Operations</a>    <ul>
      <li><a href="#insert-documents" id="markdown-toc-insert-documents">Insert Documents</a></li>
      <li><a href="#query-documents" id="markdown-toc-query-documents">Query Documents</a>        <ul>
          <li><a href="#query-on-embeddednested-documents" id="markdown-toc-query-on-embeddednested-documents">Query on Embedded/Nested Documents</a></li>
          <li><a href="#query-an-array" id="markdown-toc-query-an-array">Query an Array</a></li>
          <li><a href="#query-an-array-of-embedded-documents" id="markdown-toc-query-an-array-of-embedded-documents">Query an Array of Embedded Documents</a></li>
          <li><a href="#project-fields-to-return-from-query" id="markdown-toc-project-fields-to-return-from-query">Project Fields to Return from Query</a></li>
          <li><a href="#query-for-null-or-missing-fields" id="markdown-toc-query-for-null-or-missing-fields">Query for Null or Missing Fields</a></li>
          <li><a href="#iterate-a-cursor-in-the-mongo-shell" id="markdown-toc-iterate-a-cursor-in-the-mongo-shell">Iterate a Cursor in the mongo Shell</a></li>
        </ul>
      </li>
      <li><a href="#update-documents" id="markdown-toc-update-documents">Update Documents</a>        <ul>
          <li><a href="#update-methods" id="markdown-toc-update-methods">Update Methods</a></li>
        </ul>
      </li>
      <li><a href="#delete-documents" id="markdown-toc-delete-documents">Delete Documents</a></li>
      <li><a href="#bulk-write-operations" id="markdown-toc-bulk-write-operations">Bulk Write Operations</a></li>
      <li><a href="#sql-to-mongodb-mapping-chart" id="markdown-toc-sql-to-mongodb-mapping-chart">SQL to MongoDB Mapping Chart</a></li>
      <li><a href="#read-concern" id="markdown-toc-read-concern">Read Concern*</a></li>
      <li><a href="#write-concern" id="markdown-toc-write-concern">Write Concern*</a></li>
      <li><a href="#mongodb-crud-concepts" id="markdown-toc-mongodb-crud-concepts">MongoDB CRUD Concepts</a>        <ul>
          <li><a href="#atomicity-and-transactions" id="markdown-toc-atomicity-and-transactions">Atomicity and Transactions</a></li>
          <li><a href="#read-isolation-consistency-and-recency" id="markdown-toc-read-isolation-consistency-and-recency">Read Isolation, Consistency, and Recency</a></li>
          <li><a href="#distributed-queries" id="markdown-toc-distributed-queries">Distributed Queries</a></li>
          <li><a href="#distributed-write-operations" id="markdown-toc-distributed-write-operations">Distributed Write Operations</a></li>
          <li><a href="#perform-two-phase-commits" id="markdown-toc-perform-two-phase-commits">Perform Two Phase Commits</a></li>
          <li><a href="#linearizable-reads-via-findandmodify" id="markdown-toc-linearizable-reads-via-findandmodify">Linearizable Reads via findAndModify*</a></li>
          <li><a href="#query-plans" id="markdown-toc-query-plans">Query Plans</a></li>
          <li><a href="#query-optimization" id="markdown-toc-query-optimization">Query Optimization</a>            <ul>
              <li><a href="#åˆ›å»ºç´¢å¼•" id="markdown-toc-åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</a></li>
              <li><a href="#è¦†ç›–ç´¢å¼•" id="markdown-toc-è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•</a></li>
              <li><a href="#evaluate-performance-of-current-operations" id="markdown-toc-evaluate-performance-of-current-operations">Evaluate Performance of Current Operations</a></li>
              <li><a href="#optimize-query-performance" id="markdown-toc-optimize-query-performance">Optimize Query Performance</a></li>
              <li><a href="#write-operation-performance" id="markdown-toc-write-operation-performance">Write Operation Performance</a></li>
              <li><a href="#explain-results" id="markdown-toc-explain-results">Explain Results*</a></li>
            </ul>
          </li>
          <li><a href="#analyze-query-performance" id="markdown-toc-analyze-query-performance">Analyze Query Performance</a>            <ul>
              <li><a href="#compare-performance-of-indexes" id="markdown-toc-compare-performance-of-indexes">Compare Performance of Indexes</a></li>
            </ul>
          </li>
          <li><a href="#tailable-cursors" id="markdown-toc-tailable-cursors">Tailable Cursors</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#aggregation" id="markdown-toc-aggregation">Aggregation</a></li>
</ul>

<p><a href="https://docs.mongodb.com/manual/">MongoDB Manual</a></p>

<h1 id="getting-started-with-mongodb-mongodb-shell-edition">Getting Started with MongoDB (MongoDB Shell Edition)</h1>
<h2 id="introduction-to-mongodb">Introduction to MongoDB</h2>
<p>MongoDBæ˜¯ä¸€ç§åŸºäºæ–‡æ¡£ï¼ˆDocumentï¼‰çš„æ•°æ®åº“ï¼ŒDocumentçš„ç»“æ„ç±»ä¼¼JSONå¯¹è±¡ï¼ˆå®é™…ä½¿ç”¨BSONå¯¹è±¡ï¼Œå…·æœ‰æ¯”JSONæ›´å¥½çš„æŸ¥æ‰¾æ€§èƒ½ï¼Œä¸”èƒ½ç›´æ¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚
Documentä¿å­˜åœ¨é›†åˆï¼ˆCollectionsï¼‰ä¸­ï¼ŒDocumentå¯¹åº”å…³ç³»æ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ï¼ŒCollectionså¯¹åº”å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€‚åŒºåˆ«åœ¨äºï¼Œå…³ç³»æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•éƒ½æ˜¯åŒæ„çš„ï¼Œè€ŒåŒä¸€ä¸ªCollectionsçš„ä¸åŒDocumentå¯ä»¥å¼‚æ„ã€‚
æ¯ä¸€ä¸ªDocumentéƒ½å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º<code class="language-plaintext highlighter-rouge">_id</code>çš„å­—æ®µï¼Œå…¶ä½œç”¨ç±»ä¼¼å…³ç³»æ•°æ®åº“çš„ä¸»é”®ã€‚</p>

<h2 id="install-mongodb">Install MongoDB</h2>
<p>ç•¥</p>

<h2 id="mongodb-shell-mongo">MongoDB Shell (mongo)</h2>
<p>ç•¥</p>

<h2 id="insert-data-with-the-mongo-shell">Insert Data with the mongo Shell</h2>
<p>å¦‚æœå¾€ä¸€ä¸ªä¸å­˜åœ¨çš„Collectionä¸­æ·»åŠ æ–°çš„Documentï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ›å»ºè¯¥Collectionã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use test

db.restaurants.insert(
   {
      "address" : {
         "street" : "2 Avenue",
         "zipcode" : "10075",
         "building" : "1480",
         "coord" : [ -73.9557413, 40.7720266 ]
      },
      "borough" : "Manhattan",
      "cuisine" : "Italian",
      "grades" : [
         {
            "date" : ISODate("2014-10-01T00:00:00Z"),
            "grade" : "A",
            "score" : 11
         },
         {
            "date" : ISODate("2014-01-16T00:00:00Z"),
            "grade" : "B",
            "score" : 17
         }
      ],
      "name" : "Vella",
      "restaurant_id" : "41704620"
   }
)
</code></pre></div></div>
<p>è¾“å‡ºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WriteResult({ "nInserted" : 1 })
</code></pre></div></div>
<p>å¦‚æœé€šè¿‡insertæ’å…¥çš„è®°å½•ä¸­æ²¡æœ‰æŒ‡æ˜_idå­—æ®µï¼ŒMongo Shellä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶æ·»åŠ è¯¥å­—æ®µã€‚</p>

<h2 id="find-or-query-data-with-the-mongo-shell">Find or Query Data with the mongo Shell</h2>
<p>åœ¨MongoDBä¸­ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢çš„ä½œç”¨åŸŸéƒ½é™åˆ¶ä¸ºå•ä¸ªçš„Collectionã€‚
æŸ¥è¯¢è¿”å›çš„æ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼ˆcursorï¼‰å½¢å¼çš„ç»“æœï¼Œæ¸¸æ ‡å¯ä»¥ç”¨æ¥è·å–å®é™…çš„Documentã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.restaurants.find()  // æŸ¥è¯¢é›†åˆä¸­çš„æ‰€æœ‰æ–‡æ¡£
db.restaurants.find( { "borough": "Manhattan" } )        // ä½¿ç”¨æ–‡æ¡£çš„ä¸€çº§å­—æ®µè¿›è¡Œè¿‡æ»¤æŸ¥è¯¢
db.restaurants.find( { "address.zipcode": "10075" } )    // ä½¿ç”¨æ–‡æ¡£çš„åµŒå¥—ï¼ˆäºŒçº§ï¼‰å­—æ®µè¿›è¡Œè¿‡æ»¤æŸ¥è¯¢
db.restaurants.find( { "grades.grade": "B" } )           // ä½¿ç”¨æ–‡æ¡£çš„æ•°ç»„å­—æ®µè¿›è¡Œè¿‡æ»¤æŸ¥è¯¢
db.restaurants.find( { "grades.score": { $gt: 30 } } )   // Greater Than
db.restaurants.find( { "grades.score": { $lt: 10 } } )   // Less Than
db.restaurants.find( { "cuisine": "Italian", "address.zipcode": "10075" } ) // AND

// OR
db.restaurants.find(
   { $or: [ { "cuisine": "Italian" }, { "address.zipcode": "10075" } ] }
)

db.restaurants.find().sort( { "borough": 1, "address.zipcode": 1 } )   // 1æ˜¯æ­£åºï¼Œ2æ˜¯å€’åº
</code></pre></div></div>
<p>æ¡ä»¶å­—æ®µå’Œæ¡ä»¶å€¼éƒ½éœ€è¦ä½¿ç”¨å¼•å·ã€‚</p>

<h2 id="update-data-with-the-mongo-shell">Update Data with the mongo Shell</h2>
<p>ä¸èƒ½æ›´æ–°_idå­—æ®µã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// æ›´æ–°æ–‡æ¡£çš„ä¸€çº§å­—æ®µ
db.restaurants.update(
    { "name" : "Juni" },
    {
      $set: { "cuisine": "American (New)" },      // $setæ“ä½œç¬¦ï¼Œè®¾ç½®å­—æ®µçš„å€¼ï¼Œå¦‚æœå­—æ®µä¸å­˜åœ¨åˆ™æ–°å»º
      $currentDate: { "lastModified": true }      // $currentDateæ“ä½œç¬¦ï¼Œå°†å­—æ®µçš„å€¼è®¾ä¸ºå½“å‰çš„æ—¥æœŸ
    }
)

// æ›´æ–°æ–‡æ¡£çš„åµŒå¥—å­—æ®µ
db.restaurants.update(
  { "restaurant_id" : "41156888" },
  { $set: { "address.street": "East 31st Street" } }
)

// æ›´æ–°å¤šä¸ªæ–‡æ¡£
// update()æ–¹æ³•é»˜è®¤åªæ›´æ–°å•ä¸ªæ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨multié€‰é¡¹æ¥æŒ‡å®šæ›´æ–°æ‰€æœ‰ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£
db.restaurants.update(
  { "address.zipcode": "10016", cuisine: "Other" },
  {
    $set: { cuisine: "Category To Be Determined" },
    $currentDate: { "lastModified": true }
  },
  { multi: true}
)

// æ›´æ–°æ•´ä¸ªæ–‡æ¡£
// æ–°çš„æ–‡æ¡£å¯ä»¥å’Œæ—§æ–‡æ¡£ç»“æ„ä¸ä¸€æ ·
// å¯ä»¥ä¸ä¼ _idå­—æ®µï¼Œå¦‚æœä¼ äº†ï¼Œå¿…é¡»ä¿è¯_idå’Œæ—§æ–‡æ¡£çš„_idä¸€æ ·
db.restaurants.update(
   { "restaurant_id" : "41704620" },
   {
     "name" : "Vella 2",
     "address" : {
              "coord" : [ -73.9557413, 40.7720266 ],
              "building" : "1480",
              "street" : "2 Avenue",
              "zipcode" : "10075"
     }
   }
)
</code></pre></div></div>

<p>ä½¿ç”¨upserté€‰é¡¹å¯ä»¥å®ç°å¦‚æœè¢«æ›´æ–°çš„è®°å½•ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ä¸€æ¡è®°å½•ã€‚</p>

<p>MongoDBä¸­åœ¨åŒä¸€ä¸ªæ–‡æ¡£ä¸Šçš„å†™æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚å¦‚æœä¸€ä¸ªæ›´æ–°æ“ä½œå°†ä¿®æ”¹å¤šä¸ªæ–‡æ¡£ï¼Œè¯¥æ›´æ–°æ“ä½œå¯ä»¥å’Œå…¶ä»–çš„å†™æ“ä½œäº¤é”™è¿›è¡Œã€‚</p>

<h2 id="remove-data-with-the-mongo-shell">Remove Data with the mongo Shell</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.restaurants.remove( { "borough": "Manhattan" } )  // åˆ é™¤æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ 
db.restaurants.remove( { "borough": "Queens" }, { justOne: true } )  // åªåˆ é™¤1ä¸ªæ–‡æ¡£
db.restaurants.remove( { } )  // åˆ é™¤conditionä¸­çš„æ‰€æœ‰æ–‡æ¡£
db.restaurants.drop()  // åˆ é™¤condition
</code></pre></div></div>

<h2 id="data-aggregation-with-the-mongo-shell">Data Aggregation with the mongo Shell</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ä½¿ç”¨æ–‡æ¡£çš„boroughå­—æ®µä½œä¸ºåˆ†ç»„çš„é”®
// ä½¿ç”¨ç´¯åŠ å™¨$sumæ¥è®¡ç®—æ¯ä¸ªåˆ†ç»„çš„è®¡æ•°
db.restaurants.aggregate(
   [
     { $group: { "_id": "$borough", "count": { $sum: 1 } } }
   ]
);
</code></pre></div></div>
<p>è¾“å‡ºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// The output documents only contain the identifier field and, if specified, accumulated fields.
{ "_id" : "Staten Island", "count" : 969 }
{ "_id" : "Brooklyn", "count" : 6086 }
{ "_id" : "Manhattan", "count" : 10259 }
{ "_id" : "Queens", "count" : 5656 }
{ "_id" : "Bronx", "count" : 2338 }
{ "_id" : "Missing", "count" : 51 }
</code></pre></div></div>

<p>åœ¨è¿›è¡Œèšåˆæ“ä½œæ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¿‡æ»¤æ¡ä»¶ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.restaurants.aggregate(
   [
     { $match: { "borough": "Queens", "cuisine": "Brazilian" } },
     { $group: { "_id": "$address.zipcode" , "count": { $sum: 1 } } }
   ]
);
</code></pre></div></div>

<h2 id="indexes-with-the-mongo-shell">Indexes with the mongo Shell</h2>
<p>åœ¨åˆ›å»ºCollectionæ—¶ï¼ŒMongoDBä¼šè‡ªåŠ¨åœ¨_idå­—æ®µä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚
åªæœ‰å½“ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåˆ›å»ºæˆåŠŸã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.restaurants.createIndex( { "cuisine": 1 } )  // åˆ›å»ºä¸€ä¸ªå•åˆ—ç´¢å¼•
db.restaurants.createIndex( { "cuisine": 1, "address.zipcode": -1 } )  // åˆ›å»ºä¸€ä¸ªå¤šåˆ—ç´¢å¼•
</code></pre></div></div>
<p>åˆ›å»ºç´¢å¼•åçš„è¿”å›ç±»ä¼¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "createdCollectionAutomatically" : false,
  "numIndexesBefore" : 1,
  "numIndexesAfter" : 2,
  "ok" : 1
}
</code></pre></div></div>

<h2 id="drivers">Drivers</h2>
<p>ç•¥</p>

<h1 id="introduction-to-mongodb-1">Introduction to MongoDB</h1>
<p>åŸºäºæ–‡æ¡£ã€é«˜æ€§èƒ½ã€å¯ŒæŸ¥è¯¢è¯­è¨€ã€é«˜å¯ç”¨ã€åŸç”Ÿæ°´å¹³æ‰©å±•ã€æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ã€‚</p>

<h2 id="databases-and-collections">Databases and Collections</h2>
<p>MongoDBç”¨BSONä¿å­˜æ–‡æ¡£ï¼Œæ¡£ä¿å­˜åœ¨é›†åˆä¸­ï¼Œé›†åˆä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</p>

<p>åœ¨ä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®åº“å’Œé›†åˆä¸å­˜åœ¨ï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œé›†åˆï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use myNewDB   // å°šä¸å­˜åœ¨çš„æ–°çš„æ•°æ®åº“
db.myNewCollection1.insertOne( { x: 1 } )
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨db.createCollection()æ¥æ˜¾å¼åœ°åˆ›å»ºé›†åˆï¼Œä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå¯ä»¥æŒ‡å®šæ›´å¤šçš„é€‰é¡¹ï¼Œæ¯”å¦‚æ–‡æ¡£æ•°é‡çš„ä¸Šé™ã€‚</p>

<p>é»˜è®¤æƒ…å†µä¸‹é›†åˆçš„æ–‡æ¡£å¯ä»¥å¼‚æ„ï¼Œä»3.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥åœ¨æ›´æ–°å’Œæ’å…¥æ“ä½œæ—¶è¿›è¡Œæ–‡æ¡£è§„åˆ™æ ¡éªŒã€‚</p>

<h3 id="views">Views</h3>
<p>ä»3.4ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥ä¸ºå·²å­˜åœ¨çš„é›†åˆæˆ–è§†å›¾åˆ›å»ºåªè¯»çš„è§†å›¾ã€‚
è¯¦ç•¥ã€‚</p>

<h3 id="capped-collections">Capped Collections</h3>
<p>å°é¡¶é›†åˆæ˜¯å°ºå¯¸å›ºå®šçš„é›†åˆï¼Œèƒ½å¤Ÿæœ‰æ•ˆæé«˜å¯¹é›†åˆçš„è¯»å†™ååç‡ã€‚å…¶å·¥ä½œæ–¹å¼ç±»ä¼¼å¾ªç¯ç¼“å†²åŒºï¼Œå½“é›†åˆæ»¡æ—¶ï¼Œæ–°çš„æ–‡æ¡£å°†è¦†ç›–æœ€æ—§çš„æ–‡æ¡£ã€‚</p>

<p>é€šè¿‡åœ¨è°ƒç”¨db.createCollection()æ—¶æŒ‡å®šcappedä¸ºtrueæ¥åˆ›å»ºå°é¡¶é›†åˆï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.createCollection("log", { capped : true, size : 5242880, max : 5000 } )
</code></pre></div></div>
<p>æ’å…¥ä¸€ä¸ªæ²¡æœ‰ç´¢å¼•çš„capped collectioné€Ÿåº¦éå¸¸æ¥è¿‘å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿã€‚ä¸ºäº†æœ€å¤§åŒ–æ€§èƒ½ï¼Œå¦‚æœåªæœ‰è¯»æ“ä½œï¼Œå»ºè®®ä¸è¦åœ¨capped collectionä¸Šåˆ›å»ºç´¢å¼•ã€‚å½“ç„¶å¦‚æœæœ‰æ›´æ–°capped collectionçš„éœ€è¦ï¼Œæœ€å¥½åˆ›å»ºç´¢å¼•ä»¥é¿å…å¯¹collectionçš„éå†ã€‚</p>

<p>ä¸èƒ½åˆ é™¤capped collectionçš„æ–‡æ¡£ï¼Œä½†æ˜¯å¯ä»¥drop capped collectionã€‚</p>

<p>å¯¹capped collectionçš„æŸ¥è¯¢æ“ä½œé»˜è®¤æŒ‰æ’å…¥é¡ºåºè¿”å›è®°å½•ã€‚ä½¿ç”¨è‡ªç„¶æ’åºï¼ˆnatural orderingï¼‰å¯ä»¥å¿«é€Ÿåœ°æŸ¥è¯¢æœ€æ–°æ’å…¥çš„è®°å½•ï¼ˆç±»ä¼¼tailæ“ä½œï¼‰:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.cappedCollection.find().sort( { $natural: -1 } )
</code></pre></div></div>

<p>å…¶ä»–æ“ä½œï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// åˆ¤æ–­ä¸€ä¸ªcollectionæ˜¯å¦æ˜¯capped collection
db.collection.isCapped()

// å°†ä¸€ä¸ªæ™®é€šcollectionè½¬æ¢ä¸ºcapped collectionï¼ˆä¼šé€ æˆå…¨å±€å†™é”ï¼‰
db.runCommand({"convertToCapped": "mycoll", size: 100000});
</code></pre></div></div>

<p><strong>MongoDBçš„æ“ä½œæ—¥å¿—æ–‡ä»¶oplog.rså°±æ˜¯åˆ©ç”¨Capped Collectionæ¥å®ç°çš„ã€‚</strong></p>

<h2 id="documents">Documents</h2>
<p>æ–‡æ¡£å­—æ®µçš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„BSON Typeï¼Œæ¯”å¦‚ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var mydoc = {
  _id: ObjectId("5099803df3f4948bd2f98391"),
  name: { first: "Alan", last: "Turing" },
  birth: new Date('Jun 23, 1912'),
  death: new Date('Jun 07, 1954'),
  contribs: [ "Turing machine", "Turing test", "Turingery" ],
  views : NumberLong(1250000)
}
</code></pre></div></div>

<p>å­—æ®µåçš„çº¦æŸï¼š</p>
<ul>
  <li>_idè¢«ä¿ç•™ä½œä¸ºä¸»é”®ä½¿ç”¨ï¼Œä¸èƒ½ä¸ºarray</li>
  <li>ä¸èƒ½ä»¥$å¼€å§‹</li>
  <li>ä¸èƒ½åŒ…å«.</li>
  <li>ä¸èƒ½åŒ…å«null</li>
</ul>

<p>å°½ç®¡BSONæœ¬èº«æ”¯æŒåŒåå­—æ®µï¼Œä½†æ˜¯MongoDBçš„Driverå®ç°å¤§å¤šä¸æ”¯æŒã€‚</p>

<p>å¯ä»¥ä»¥ç´¢å¼•å€¼çš„æ–¹å¼è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œå¦‚å¯¹äºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
   ...
   contribs: [ "Turing machine", "Turing test", "Turingery" ],
   ...
}
</code></pre></div></div>
<p>å¯ä»¥è¿™æ ·è®¿é—®å…¶ç¬¬3ä¸ªå…ƒç´ ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>contribs.2
</code></pre></div></div>

<p>BSONæ–‡æ¡£çš„æœ€å¤§å°ºå¯¸ä¸º16Må­—èŠ‚</p>

<p>_idçš„å€¼çš„çº¦æŸï¼Œç•¥ã€‚</p>

<h2 id="bson-types">BSON Types</h2>
<p>ç•¥ã€‚</p>

<h2 id="comparisonsort-order">Comparison/Sort Order</h2>
<p>å½“å¯¹ä¸åŒçš„BSONç±»å‹çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¼šéµå¾ªä¸€å®šçš„é¡ºåºï¼Œæ¯”å¦‚Objectåœ¨Arrayä¹‹å‰ï¼Œè¯¦ç•¥ã€‚</p>

<h2 id="mongodb-extended-json">MongoDB Extended JSON</h2>
<p>JSONåªèƒ½è¡¨ç¤ºBSONç±»å‹çš„å­é›†ï¼Œä¸ºäº†ä¿ç•™ç±»å‹ä¿¡æ¯ï¼ŒMongoDBå¯¹JSONæ ¼å¼è¿›è¡Œäº†å¦‚ä¸‹æ‰©å±•ï¼š</p>
<ul>
  <li>ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict modeï¼‰ï¼šå°†ä¸€äº›BSONç±»å‹è½¬æ¢ä¸ºJSONå½¢å¼ï¼Œä»»ä½•JSONè§£æå™¨éƒ½å¯ä»¥è§£æè¯¥å½¢å¼ï¼Œä½†æ˜¯åªæœ‰MongoDBå†…ç½®çš„JSONè§£æå™¨æ‰å¯ä»¥è¯†åˆ«å‡ºè¿™äº›ç±»å‹ä¿¡æ¯ã€‚</li>
  <li>mongo shell modeï¼›</li>
</ul>

<p>ä¾‹å¦‚Binaryç±»å‹åœ¨ä¸¤ç§æ¨¡å¼ä¸‹åˆ†åˆ«å¦‚ä¸‹è¡¨ç¤ºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ä¸¥æ ¼æ¨¡å¼
{ "$binary": "&lt;bindata&gt;", "$type": "&lt;t&gt;" }

// Shell Mode
BinData ( &lt;t&gt;, &lt;bindata&gt; )
</code></pre></div></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
  <li>
    <bindata>æ˜¯äºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„base64ç¼–ç è¡¨ç¤ºï¼›
</bindata>
  </li>
  <li>
    <t>æ˜¯ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œç”¨æ¥è¡¨ç¤ºæ•°æ®çš„ç±»å‹ï¼›

</t>
  </li>
</ul>
<p>è¯¦ç•¥ã€‚</p>

<h1 id="install-mongodb-1">Install MongoDB</h1>
<p>ç•¥ã€‚</p>

<h1 id="the-mongo-shell">The Mongo Shell</h1>
<p><strong>.mongorc.jsæ–‡ä»¶</strong>
å¯ä»¥æŠŠè‡ªå·±å†™çš„jsä»£ç ä¿å­˜åœ¨æŸä¸ªåœ°æ–¹ï¼Œè®©MongoDBåŠ è½½å®ƒï¼Œç„¶åå°±å¯ä»¥åœ¨Mongo Shellçš„å‘½ä»¤è¡Œé‡Œä½¿ç”¨å®ƒä»¬ã€‚
Mongodb Shellé»˜è®¤ä¼šå°è¯•åŠ è½½~/.mongorc.jsæ–‡ä»¶ã€‚</p>

<p>å¦‚æœcollectionçš„å‘½ååŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚ç©ºæ ¼æˆ–è€…ä»¥æ•°å­—å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å˜é€šçš„æ–¹æ³•æ¥å¼•ç”¨collectionï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.3test.find()    // SyntaxError
db["3test"].find()
db.getCollection("3test").find()
</code></pre></div></div>

<p>find()æ–¹æ³•è¿”å›æŒ‡å‘æ–‡æ¡£é›†åˆçš„è·¯ç”±ï¼Œä½†æ˜¯å½“åœ¨Shellä¸­æ‰§è¡Œæ—¶ï¼Œåœ¨æ²¡æœ‰å°†è¿”å›è·¯ç”±å¤åˆ¶ç»™å˜é‡çš„æƒ…å†µä¸‹ï¼ˆé€šè¿‡varå…³é”®å­—èµ‹å€¼ï¼‰ï¼ŒMongoDB Shellå°†ä¼šè‡ªåŠ¨è¿­ä»£å¹¶å±•ç¤ºå‰20ä¸ªæ–‡æ¡£ä¿¡æ¯ã€‚</p>

<p><strong>æ ¼å¼åŒ–è¾“å‡º</strong></p>
<ul>
  <li>db.myCollection.find().pretty()  // jsonæ ¼å¼åŒ–è¾“å‡º</li>
  <li>print()  // ä¸å¸¦æ ¼å¼è¾“å‡º</li>
  <li>print(tojson(<obj>))  // jsonæ ¼å¼åŒ–è¾“å‡º</obj></li>
  <li>printjson() // jsonæ ¼å¼åŒ–è¾“å‡º</li>
</ul>

<p><strong>è·¨è¡Œæ“ä½œ</strong>
å½“æŸä¸€è¡Œä»¥æ‹¬å·((ã€[ã€{)ç»“å°¾æ—¶ï¼Œå¯ä»¥è·¨è¡Œæ“ä½œï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; var x = 1;
&gt; if(x&gt;0){
... print(x);
... }

1
</code></pre></div></div>
<p>å¦‚æœè¿ç»­è¾“å…¥ä¸¤ä¸ªç©ºè¡Œï¼Œå°†ä¼šç»“æŸè·¨è¡Œæ“ä½œæ¨¡å¼ã€‚
Mongo Shellæ˜¯ä¸€ä¸ªJavaScriptæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‰§è¡ŒJavaScriptä»£ç ã€‚</p>

<h2 id="configure-the-mongo-shell">Configure the mongo Shell</h2>
<p>å¯ä»¥é€šè¿‡è®¾ç½®promptå˜é‡æ¥è‡ªå®šä¹‰Mongo Shellçš„æç¤ºç¬¦ã€‚å¯ä»¥å°†è®¾ç½®promptå˜é‡çš„é€»è¾‘æ”¾åœ¨.mongorc.jsæ–‡ä»¶ä¸­ã€‚
ä¸¾ä¾‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1&gt;
test@myHost1$
Uptime:5897 Documents:6 &gt;
</code></pre></div></div>

<p>å¯ä»¥è®¾ç½®å½“åœ¨Mongo Shellä¸­è¦ç¼–è¾‘ä»£ç æ—¶çš„ç¼–è¾‘å™¨ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export EDITOR=vim
mongo
</code></pre></div></div>
<p>è¯¦ç•¥ã€‚</p>

<p>å¯ä»¥è®¾ç½®Mongo Shellè‡ªåŠ¨è§£æfind()ç»“æœçš„æ•°é‡ï¼ˆé»˜è®¤ä¸º20æ¡ï¼‰ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DBQuery.shellBatchSize = 10;
</code></pre></div></div>

<h2 id="access-the-mongo-shell-help">Access the mongo Shell Help</h2>
<p>ç•¥</p>

<h2 id="write-scripts-for-the-mongo-shell">Write Scripts for the mongo Shell</h2>
<p>å°±æ˜¯åœ¨mongo Shellä¸­ç¼–å†™å¹¶æ‰§è¡ŒJavaScriptä»£ç ã€‚ç•¥ã€‚</p>

<h2 id="data-types-in-the-mongo-shell">Data Types in the mongo Shell</h2>
<p>Mongo Shellå¯¹BSONæ‰©å±•ç±»å‹çš„æ”¯æŒã€‚ç•¥ã€‚</p>

<h2 id="mongo-shell-quick-reference">mongo Shell Quick Reference</h2>
<p>åœ¨Mongo Shellä¸­å¯ä»¥æ‰“å¼€å¹¶ä½¿ç”¨å¦ä¸€ä¸ªdbï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db = connect("&lt;host&gt;&lt;:port&gt;/&lt;dbname&gt;")
db....
</code></pre></div></div>
<p>è¯¦ç•¥ã€‚</p>

<h1 id="mongodb-crud-operations">MongoDB CRUD Operations</h1>
<h2 id="insert-documents">Insert Documents</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.collection.insertOne()
db.collection.insertMany()
db.collection.insert()
db.collection.save()
db.collection.bulkWrite()
</code></pre></div></div>
<p>å½“ä½¿ç”¨<code class="language-plaintext highlighter-rouge">upsert:true</code>é€‰é¡¹æ—¶ï¼Œå¦‚ä¸‹çš„æ–¹æ³•ä¹Ÿä¼šæ’å…¥æ–°çš„æ–‡æ¡£ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.collection.update()
db.collection.updateOne()
db.collection.updateMany()
db.collection.findAndModify()
db.collection.findOneAndUpdate()
db.collection.findOneAndReplace()
</code></pre></div></div>

<h2 id="query-documents">Query Documents</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.find( {} )  // æŸ¥æ‰¾æ‰€æœ‰æ–‡æ¡£ï¼ˆä¼ ä¸€ä¸ªç©ºçš„è¿‡æ»¤æ¡ä»¶ï¼‰
db.inventory.find( { status: "D" } )  // æŒ‰æ¡ä»¶æŸ¥è¯¢
db.inventory.find( { status: { $in: [ "A", "D" ] } } )  // ä½¿ç”¨æŸ¥è¯¢æ“ä½œç¬¦
db.inventory.find( { status: "A", qty: { $lt: 30 } } )  // AND
db.inventory.find( { $or: [ { status: "A" }, { qty: { $lt: 30 } } ] } )  // OR

// AND OR
db.inventory.find( {
     status: "A",
     $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ]
} )
</code></pre></div></div>

<h3 id="query-on-embeddednested-documents">Query on Embedded/Nested Documents</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.find( { size: { h: 14, w: 21, uom: "cm" } } )  // æ³¨æ„è¿™ç§æ–¹å¼æŸ¥è¯¢ï¼Œå­—æ®µçš„é¡ºåºä¹Ÿè¦ä¸å­—æ®µè¢«æ’å…¥æ—¶ä¸€è‡´

db.inventory.find( { "size.uom": "in" } )  // ä½¿ç”¨.æ“ä½œç¬¦

db.inventory.find( { "size.h": { $lt: 15 } } )  // ä½¿ç”¨è¿ç®—ç¬¦
</code></pre></div></div>

<h3 id="query-an-array">Query an Array</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.find( { tags: ["red", "blank"] } )  // tagså­—æ®µå¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”è¯¥æ•°ç»„çš„å­—æ®µé¡ºåºè¦ä¸æŸ¥è¯¢æ¡ä»¶ä¸€è‡´

db.inventory.find( { tags: { $all: ["red", "blank"] } } )  // æ•°ç»„å…ƒç´ çš„é¡ºåºå¯ä»¥ä¸ä¸€è‡´ï¼Œåªè¦éƒ½æœ‰å°±è¡Œ

db.inventory.find( { tags: "red" } )  // æ•°ç»„ä¸­å¿…é¡»åŒ…å«redå…ƒç´ 

db.inventory.find( { dim_cm: { $gt: 25 } } )  // æ•°ç»„ä¸­å¿…é¡»åŒ…å«å¤§äºç­‰äº25çš„å…ƒç´ 

db.inventory.find( { dim_cm: { $gt: 15, $lt: 20 } } )  // dim_cmæ•°ç»„å¿…é¡»å­˜åœ¨æ»¡è¶³2ä¸ªæ¡ä»¶çš„å…ƒç´ ï¼Œæ¯”å¦‚1ä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶1ï¼Œå¦ä¸€ä¸ªæ»¡è¶³æ¡ä»¶2

db.inventory.find( { dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } } )  // å¿…é¡»å­˜åœ¨åŒæ—¶æ»¡è¶³2ä¸ªæ¡ä»¶çš„å…ƒç´ 

db.inventory.find( { "dim_cm.1": { $gt: 25 } } )  // æ ¹æ®æ•°ç»„æŒ‡å®šä½ç½®å…ƒç´ è¿›è¡ŒæŸ¥è¯¢

db.inventory.find( { "tags": { $size: 3 } } )  // æ ¹æ®æ•°ç»„å¤§å°è¿›è¡ŒæŸ¥è¯¢
</code></pre></div></div>

<h3 id="query-an-array-of-embedded-documents">Query an Array of Embedded Documents</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// { item: "journal", instock: [ { warehouse: "A", qty: 5 }, { warehouse: "C", qty: 15 } ] },

db.inventory.find( { "instock": { warehouse: "A", qty: 5 } } )    // é¡ºåºè¦ä¸€è‡´
db.inventory.find( { 'instock.0.qty': { $lte: 20 } } )  // åŒæ—¶ä½¿ç”¨æ•°ç»„ç´¢å¼•å’ŒåµŒå¥—å­—æ®µ 
db.inventory.find( { "instock.qty": { $gt: 10,  $lte: 20 } } )  // å­˜åœ¨æ»¡è¶³æ¡ä»¶1çš„å…ƒç´ ï¼Œä¸”å­˜åœ¨æ»¡è¶³æ¡ä»¶2çš„å…ƒç´ 
db.inventory.find( { "instock": { $elemMatch: { qty: { $gt: 10, $lte: 20 } } } } )  // å­˜åœ¨åŒæ—¶æ»¡è¶³æ¡ä»¶1å’Œ2çš„å…ƒç´ 
</code></pre></div></div>
<p>æ€»ä¹‹ï¼Œå½“å¯¹æ•°ç»„å­—æ®µç»§ç»­è¿‡æ»¤æŸ¥è¯¢æ—¶ï¼Œä¸ä½¿ç”¨$elemMatchæ“ä½œç¬¦ï¼Œåˆ™æ„å‘³ç€åªè¦æ¯ä¸ªæŸ¥è¯¢æ¡ä»¶éƒ½èƒ½å¤Ÿåœ¨æ•°ç»„ä¸­æ‰¾åˆ°è‡³å°‘ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ å³å¯ã€‚å¦‚æœä½¿ç”¨$elemMatchæ“ä½œç¬¦ï¼Œåˆ™æ„å‘³ç€æ•°ç»„ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªåŒæ—¶æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„å…ƒç´ ã€‚</p>

<h3 id="project-fields-to-return-from-query">Project Fields to Return from Query</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// { item: "journal", status: "A", size: { h: 14, w: 21, uom: "cm" }, instock: [ { warehouse: "A", qty: 5 } ] },

db.inventory.find( { status: "A" }, { item: 1, status: 1 } )  // åªè¿”å›_idï¼Œitemå’Œstatuså­—æ®µ
db.inventory.find( { status: "A" }, { item: 1, status: 1, _id: 0 } )   // åªè¿”å›itemå’Œstatuså­—æ®µ
db.inventory.find( { status: "A" }, { status: 0, instock: 0 } )  // è¿”å›é™¤äº†statuså’Œinstockä¹‹å¤–çš„æ‰€æœ‰å­—æ®µ

// æŒ‡å®šåµŒå¥—æ–‡æ¡£ä¸­åº”è¯¥è¿”å›çš„å­—æ®µ
db.inventory.find(
   { status: "A" },
   { item: 1, status: 1, "size.uom": 1 }
)

// æ’é™¤åµŒå¥—æ–‡æ¡£ä¸­æŒ‡å®šçš„å­—æ®µ
db.inventory.find(
   { status: "A" },
   { "size.uom": 0 }
)

db.inventory.find( { status: "A" }, { item: 1, status: 1, "instock.qty": 1 } )  // instockæ•°ç»„ä¸­çš„å…ƒç´ åªè¿”å›qtyå­—æ®µ

db.inventory.find( { status: "A" }, { name: 1, status: 1, instock: { $slice: -1 } } )  // åªè¿”å›instockæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ 
</code></pre></div></div>

<h3 id="query-for-null-or-missing-fields">Query for Null or Missing Fields</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*
{ _id: 1, item: null },
{ _id: 2 }
*/

db.inventory.find( { item: null } )  // itemå­—æ®µä¸ºnullæˆ–è€…ä¸å­˜åœ¨itemå­—æ®µ
db.inventory.find( { item : { $type: 10 } } )  // itemå­—æ®µä¸ºnullï¼ˆBSON Type Null (i.e. 10) ï¼‰
db.inventory.find( { item : { $exists: false } } )  // itemå­—æ®µä¸å­˜åœ¨
</code></pre></div></div>

<h3 id="iterate-a-cursor-in-the-mongo-shell">Iterate a Cursor in the mongo Shell</h3>
<p>åœ¨Mongo Shellä¸­ï¼Œå½“æŠŠfind()çš„è¿”å›ç»“æœï¼ˆæ¸¸æ ‡ï¼‰é€šè¿‡varèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æ—¶ï¼Œfind()è¿”å›çš„ç»“æœä¸ä¼šè‡ªåŠ¨è¿­ä»£ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myCursor = db.users.find( { type: 2 } );

// è‡ªåŠ¨éå†20æ¬¡
myCursor  

// æ‰‹åŠ¨éå†
while (myCursor.hasNext()) {
   print(tojson(myCursor.next()));
}

// é€šè¿‡forEachéå†
myCursor.forEach(printjson);

// è½¬æˆæ•°ç»„åè¿›è¡Œæ“ä½œ
var documentArray = myCursor.toArray();
var myDocument = documentArray[3];
</code></pre></div></div>

<p>æ¸¸æ ‡çš„å…¶ä»–æ“ä½œï¼Œæ¯”å¦‚è®¾ç½®ä¸è¿‡æœŸï¼Œå¤šä¸ªæŸ¥è¯¢çš„æ¸¸æ ‡éš”ç¦»ï¼Œç»Ÿè®¡å½“å‰æ‰“å¼€çš„æ¸¸æ ‡æ•°é‡åŠçŠ¶æ€ç­‰ç­‰ï¼Œè¯¦ç•¥ã€‚</p>

<h2 id="update-documents">Update Documents</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// { item: "canvas", qty: 100, size: { h: 28, w: 35.5, uom: "cm" }, status: "A" },

db.inventory.updateOne(
   { item: "paper" },  // è¿‡æ»¤æ¡ä»¶
   {
     $set: { "size.uom": "cm", status: "P" },
     $currentDate: { lastModified: true }   // å°†lastModifiedå­—æ®µè®¾ä¸ºå½“å‰æ—¶é—´ï¼Œå¦‚æœå­—æ®µä¸å­˜åœ¨åˆ™æ–°å»º
   }
)

db.inventory.updateMany(
   ...
)


// å½“ä½¿ç”¨replaceæ“ä½œæ—¶ï¼Œä¸èƒ½å¸¦updateæ“ä½œç¬¦
db.inventory.replaceOne(
   { item: "paper" },
   { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 40 } ] }
)
</code></pre></div></div>

<p>ä¸€æ—¦å€¼è¢«è®¾ç½®ï¼Œ_idå­—æ®µçš„å€¼å°±ä¸å¯æ”¹å˜ï¼Œä¹Ÿä¸èƒ½é€šè¿‡å¸¦æœ‰æ–°çš„_idå€¼çš„æ–‡æ¡£æ¥è¦†ç›–æ—§çš„æ–‡æ¡£ã€‚</p>

<h3 id="update-methods">Update Methods</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.collection.updateOne()
db.collection.updateMany()
db.collection.replaceOne()
db.collection.update()
</code></pre></div></div>

<h2 id="delete-documents">Delete Documents</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.collection.deleteMany()
db.collection.deleteOne()
db.collection.remove()  // When talking about node.js drivers, remove has been deprecated
</code></pre></div></div>

<h2 id="bulk-write-operations">Bulk Write Operations</h2>
<p>db.collection.bulkWrite()æ–¹æ³•æ”¯æŒæ‰¹é‡åœ°æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œã€‚åœ¨è¿›è¡Œæ‰¹é‡æ“ä½œæ—¶ï¼Œæ”¯æŒæ’åºè¡Œä¸ºã€‚é»˜è®¤é‡‡ç”¨æ’åºæ–¹å¼ï¼Œå½“é‡‡ç”¨æ’åºæ–¹å¼æ“ä½œæ—¶ï¼Œæ‰€æœ‰æ“ä½œè¦é€ä¸ªè¿›è¡Œï¼Œå‘ç”Ÿé”™è¯¯æ—¶ï¼Œåç»­æ“ä½œç»ˆæ­¢ã€‚å½“é‡‡ç”¨éæ’åºæ–¹å¼æ“ä½œæ—¶ï¼Œæ‰€æœ‰æ“ä½œå¯å¹¶å‘è¿›è¡Œï¼Œå¤±è´¥çš„æ“ä½œä¸å½±å“å…¶ä»–å¹¶è¡Œæ“ä½œã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>try {
   db.characters.bulkWrite(
      [
         { insertOne :
            {
               "document" :
               {
                  "_id" : 4, "char" : "Dithras", "class" : "barbarian", "lvl" : 4
               }
            }
         },
         { insertOne :
            {
               "document" :
               {
                  "_id" : 5, "char" : "Taeln", "class" : "fighter", "lvl" : 3
               }
            }
         },
         { updateOne :
            {
               "filter" : { "char" : "Eldon" },
               "update" : { $set : { "status" : "Critical Injury" } }
            }
         },
         { deleteOne :
            { "filter" : { "char" : "Brisbane"} }
         },
         { replaceOne :
            {
               "filter" : { "char" : "Meldane" },
               "replacement" : { "char" : "Tanys", "class" : "oracle", "lvl" : 4 }
            }
         }
      ]
   );
}
catch (e) {
   print(e);
}
</code></pre></div></div>

<p><strong>Strategies for Bulk Inserts to a Sharded Collection</strong>
ç•¥ã€‚</p>

<h2 id="sql-to-mongodb-mapping-chart">SQL to MongoDB Mapping Chart</h2>
<p>ç•¥ã€‚</p>

<h2 id="read-concern">Read Concern*</h2>
<p>readConcerné€‰é¡¹ç”¨äºæ§åˆ¶ä»æŸ¥è¯¢ä¸­è¿”å›çš„æ•°æ®ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªç­‰çº§ï¼š</p>
<ul>
  <li>local é»˜è®¤å€¼ï¼Œæ‰€è¯»çš„æ•°æ®ä¸ä¿è¯ä¼šè¢«æœ€ç»ˆå†™å…¥ï¼ˆå¯èƒ½è¢«å›æ»šï¼‰</li>
  <li>majority è¿”å›æœ€æ–°çš„ï¼Œå·²ç¡®è®¤å†™å…¥çš„æ•°æ®</li>
  <li>linearizable è¿”å›ä¸å¯èƒ½è¢«å›æ»šçš„æ•°æ®</li>
</ul>

<p>å¯ç”¨äºfindã€aggregateã€distinctã€countã€parallelCollectionScanã€geoNearã€geoSearchç­‰æ“ä½œã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.restaurants.find( { _id: 5 } ).readConcern("linearizable").maxTimeMS(10000)
</code></pre></div></div>

<p>è¯¦ç•¥ã€‚</p>

<h2 id="write-concern">Write Concern*</h2>
<p>ç•¥ã€‚</p>

<h2 id="mongodb-crud-concepts">MongoDB CRUD Concepts</h2>
<h3 id="atomicity-and-transactions">Atomicity and Transactions</h3>
<p>å½“åŒæ—¶æ›´æ–°å¤šä¸ªæ–‡æ¡£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨$isolatedæ“ä½œç¬¦æ¥å°†å¤šä¸ªå†™æ“ä½œç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸å…¶å®ƒçš„å†™æ“ä½œéš”ç¦»ã€‚åœ¨è¿™äº›å†™æ“ä½œæ‰§è¡ŒæœŸé—´ï¼Œå…¶å®ƒçš„å¯¹ç›¸åŒæ–‡æ¡£çš„å†™æ“ä½œè¯·æ±‚å°†è¢«é˜»æ­¢ã€‚
ä¸è¿‡ï¼Œå½“è¢«éš”ç¦»çš„è¯·æ±‚ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œé”™è¯¯ä¹‹å‰çš„æ“ä½œå¹¶ä¸ä¼šå›æ»šï¼Œå³éš”ç¦»æ“ä½œä»…èµ·åˆ°å¯¹ä¸€ç»„èµ„æºè¿›è¡Œå†™é”çš„åŠŸèƒ½ï¼Œå¹¶ä¸æä¾›å›æ»šåŠŸèƒ½ã€‚</p>

<h3 id="read-isolation-consistency-and-recency">Read Isolation, Consistency, and Recency</h3>
<ul>
  <li>Read Uncommitted
ä½¿ç”¨localçº§åˆ«çš„readConcernçš„å®¢æˆ·ç«¯å¯ä»¥è¯»å–å…¶ä»–å®¢æˆ·ç«¯çš„å°šæœªè¢«æŒä¹…åŒ–çš„å†™æ“ä½œçš„ç»“æœï¼ˆå¯èƒ½ä¼šè¢«å›æ»šï¼‰ã€‚</li>
  <li>Read Uncommitted And Single Document Atomicity
å†™æ“ä½œåœ¨å•ä¸ªæ–‡æ¡£ä¸Šæ˜¯åŸå­çš„ï¼Œå³ä¸å¯èƒ½è¯»å–åˆ°åªæœ‰éƒ¨åˆ†æ›´æ–°çš„å•ä¸€æ–‡æ¡£ã€‚</li>
  <li>Read Uncommitted And Multiple Document Write
$isolated operatorï¼Œç•¥ã€‚</li>
  <li>Cursor Snapshot
ç•¥ã€‚</li>
</ul>

<h3 id="distributed-queries">Distributed Queries</h3>
<p>sharded clustersï¼Œåˆ†ç‰‡é›†ç¾¤å¯ä»¥å®ç°ä»¥å¯¹åº”ç”¨ç¨‹åºé€æ˜çš„æ–¹å¼å°†æ•°æ®é›†åˆ†æ•£å­˜å‚¨åˆ°ä¸åŒçš„Mongo Serverï¼ˆé›†ç¾¤ï¼‰ä¸­ã€‚
æŒ‡å‘åˆ†ç‰‡æ•°æ®é›†ï¼ˆè¢«åˆ†ç‰‡å¤„ç†çš„Collectionçš„å…¶ä¸­ä¸€ä¸ªåˆ†ç‰‡ï¼‰çš„æŸ¥è¯¢éœ€è¦å¸¦ä¸Šä¸€ä¸ªåˆ†ç‰‡é”®ï¼ˆshard keyï¼‰ï¼ŒmongoDBä¼šé€šè¿‡Config Databaseä¸­é…ç½®çš„é›†ç¾¤å…ƒæ•°æ®ï¼ˆcluster metadataï¼‰æ¥å°†æŸ¥è¯¢å®šå‘åˆ°æŒ‡å®šçš„åˆ†ç‰‡æ•°æ®é›†ã€‚
å¦‚æœæŸ¥è¯¢ä¸­æ²¡æœ‰å¸¦ä¸Šshard keyï¼Œé‚£ä¹ˆMangoä¼šå°†æŸ¥è¯¢å®šå‘åˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„åˆ†ç‰‡ï¼Œè¿™æ˜¯ä¸€ç§ä½æ•ˆè¡Œä¸ºã€‚</p>

<p>Read Operations to Replica Setsï¼Œç•¥ã€‚</p>

<h3 id="distributed-write-operations">Distributed Write Operations</h3>
<p>ç•¥ã€‚</p>

<h3 id="perform-two-phase-commits">Perform Two Phase Commits</h3>
<p>å› ä¸ºMongoDBçš„æ–‡æ¡£æ”¯æŒåµŒå¥—ï¼Œæ‰€ä»¥å•æ–‡æ¡£å¯ä»¥è§£å†³å¤§å¤šæ•°çš„å…³ç³»å‹æ•°æ®åº“æ‰€é¢ä¸´çš„è·¨è¡¨æ“ä½œäº‹åŠ¡é—®é¢˜ã€‚
å› ä¸ºMongoDBå¯¹äºå•æ–‡æ¡£çš„æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥two-phase commitsåªèƒ½æä¾›ç±»ä¼¼äº‹åŠ¡çš„æ“ä½œï¼Œè€ŒéçœŸæ­£çš„äº‹åŠ¡æ“ä½œã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.accounts.insert(
   [
     { _id: "A", balance: 1000, pendingTransactions: [] },
     { _id: "B", balance: 1000, pendingTransactions: [] }
   ]
)

// æ¯ä¸€ç¬”è´¦æˆ·å˜åŠ¨éƒ½éœ€è¦æ’å…¥ä¸€æ¡è®°å½•
db.transactions.insert(
    { _id: 1, source: "A", destination: "B", value: 100, state: "initial", lastModified: new Date() }
)


var t = db.transactions.findOne( { state: "initial" } )
db.transactions.update(
    { _id: t._id, state: "initial" },
    {
      $set: { state: "pending" },   // æ›´æ–°è½¬è´¦è®°å½•çš„çŠ¶æ€ä¸ºå¤„ç†ä¸­
      $currentDate: { lastModified: true }
    }
)

// æ‰£å‡è½¬å‡ºè´¦æˆ·
db.accounts.update(
   { _id: t.source, pendingTransactions: { $ne: t._id } },  // é˜²æ­¢é‡å¤æ‰§è¡Œ
   { $inc: { balance: -t.value }, $push: { pendingTransactions: t._id } }
)

// å¢åŠ è½¬å…¥è´¦æˆ·
db.accounts.update(
   { _id: t.destination, pendingTransactions: { $ne: t._id } },
   { $inc: { balance: t.value }, $push: { pendingTransactions: t._id } }
)

// æ›´æ–°è½¬è´¦è®°å½•
db.transactions.update(
   { _id: t._id, state: "pending" },
   {
     $set: { state: "applied" },   // æ›´æ–°è½¬è´¦è®°å½•çŠ¶æ€ä¸ºå·²æ‰§è¡Œ
     $currentDate: { lastModified: true }
   }
)


// åˆ é™¤è½¬å‡ºè´¦æˆ·ä¸­çš„å¾…å¤„ç†æ“ä½œ
db.accounts.update(
   { _id: t.source, pendingTransactions: t._id },
   { $pull: { pendingTransactions: t._id } }
)

// åˆ é™¤è½¬å…¥è´¦æˆ·ä¸­çš„å¾…å¤„ç†æ“ä½œ
db.accounts.update(
   { _id: t.destination, pendingTransactions: t._id },
   { $pull: { pendingTransactions: t._id } }
)

// æ›´æ–°è½¬è´¦æ“ä½œä¸ºå·²å®Œæˆ
db.transactions.update(
   { _id: t._id, state: "applied" },
   {
     $set: { state: "done" },
     $currentDate: { lastModified: true }
   }
)
</code></pre></div></div>

<p>æ ¹æ®lastModifiedæ¥åˆ¤æ–­æ“ä½œæ˜¯å¦è¶…æ—¶ï¼Œè¿›è€Œåˆ¤æ–­æ“ä½œå¤±è´¥ï¼Œå¹¶è¿›è¡Œå›æ»šæ“ä½œ:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var dateThreshold = new Date();
dateThreshold.setMinutes(dateThreshold.getMinutes() - 30);

var t = db.transactions.findOne( { state: "pending", lastModified: { $lt: dateThreshold } } );
</code></pre></div></div>

<p>æ€»ä¹‹å°±æ˜¯è‡ªå·±ç»´æŠ¤ä¸€è‡´æ€§çš„é€»è¾‘ï¼Œå…·ä½“çš„æ¢å¤æ“ä½œï¼Œç•¥ã€‚</p>

<h3 id="linearizable-reads-via-findandmodify">Linearizable Reads via findAndModify*</h3>
<p>ç•¥ã€‚</p>

<h3 id="query-plans">Query Plans</h3>
<p>æŸ¥è¯¢ä¼˜åŒ–å™¨ç”ŸæˆæŸ¥è¯¢è®¡åˆ’ï¼Œå¹¶ç¼“å­˜ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨db.collection.explain()æˆ–cursor.explain()æ¥æŸ¥çœ‹æŒ‡å®šæŸ¥è¯¢æ‰€ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚</p>

<p>è¯¦ç•¥ã€‚</p>

<h3 id="query-optimization">Query Optimization</h3>
<h4 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.createIndex( { type: 1 } )
</code></pre></div></div>

<h4 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.createIndex( { type: 1, item: 1 } )
db.inventory.find(
   { type: "food", item:/^c/ },
   { item: 1, _id: 0 }   // å¿…é¡»è¦æ’é™¤_idï¼Œå› ä¸ºå®ƒæ²¡æœ‰åŒ…å«åœ¨ç»„åˆç´¢å¼•ä¸­
)
</code></pre></div></div>

<p>å¦‚æœä¸€ä¸ªç”¨äºåˆ›å»ºç´¢å¼•çš„å­—æ®µæ˜¯æ•°ç»„ï¼Œåˆ™è¯¥ç´¢å¼•å°†ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªå¤šé”®æ•°ç»„ï¼Œè€Œä¸”ä¸èƒ½æ”¯æŒè¦†ç›–ç´¢å¼•æŸ¥è¯¢ã€‚
å¦‚æœä¸€ä¸ªç”¨äºåˆ›å»ºç´¢å¼•çš„å­—æ®µå±äºåµŒå¥—æ–‡æ¡£ï¼Œåˆ™ä¸èƒ½æ”¯æŒè¦†ç›–ç´¢å¼•ï¼š
æ•°æ®ç»“æ„ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ _id: 1, user: { login: "tester" } }
</code></pre></div></div>
<p>ç´¢å¼•ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ "user.login": 1 }
</code></pre></div></div>
<p>å¦‚ä¸‹çš„æŸ¥è¯¢å°†ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆä¸è¿‡ä»ç„¶å¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•æ¥åŒ¹é…æŸ¥è¯¢ï¼‰ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.users.find( { "user.login": "tester" }, { "user.login": 1, _id: 0 } )
</code></pre></div></div>

<p>å¯¹äºsharded collectionï¼Œå½“æŸ¥è¯¢æœªåŒ…å«shard keyæ—¶ï¼Œå°†ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚_idé™¤å¤–ï¼Œå½“æŸ¥è¯¢æ¡ä»¶ä¸­ä»…ä»…è®¾ç½®äº†æ ¹æ®_idæŸ¥è¯¢ï¼Œä¸”æŸ¥è¯¢ç»“æœä¹Ÿä»…è¿”å›_idå­—æ®µæ—¶ï¼Œ_idç´¢å¼•å°†å¯ä»¥è¦†ç›–æ­¤æŸ¥è¯¢ã€‚</p>

<h4 id="evaluate-performance-of-current-operations">Evaluate Performance of Current Operations</h4>
<p>db.currentOp()å¯ä»¥ç”¨æ¥è¯„ä¼°å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯çš„æ“ä½œçš„æ€§èƒ½ã€‚</p>

<h4 id="optimize-query-performance">Optimize Query Performance</h4>
<p>å¦‚æœç´¢å¼•æ˜¯BinDataç±»å‹ï¼Œä¸”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæ•ˆç‡å°†æ›´é«˜ï¼š</p>
<ul>
  <li>å€¼åœ¨0~7æˆ–è€…128~135ä¹‹é—´ï¼›</li>
  <li>æ•°ç»„çš„é•¿åº¦ä¸ºï¼š0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ10ï¼Œ12ï¼Œ14ï¼Œ16ï¼Œ20ï¼Œ24ï¼Œ32</li>
</ul>

<p><em>é™åˆ¶è¿”å›çš„æ•°é‡</em></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.posts.find().sort( { timestamp : -1 } ).limit(10)
</code></pre></div></div>

<p><em>åªè¿”å›éœ€è¦çš„å­—æ®µ</em></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.posts.find( {}, { timestamp : 1 , title : 1 , author : 1 , abstract : 1} ).sort( { timestamp : -1 } )
</code></pre></div></div>

<p><em>ä½¿ç”¨$hintæ¥è®¾ç½®æƒ³è¦ä½¿ç”¨çš„ç´¢å¼•</em>
<em>ä½¿ç”¨$incæ“ä½œç¬¦æ¥æ‰§è¡Œæ•°å­—å¢åŠ æ“ä½œ</em></p>

<h4 id="write-operation-performance">Write Operation Performance</h4>
<p>ç´¢å¼•ä¼šå¢åŠ å†™æ“ä½œçš„å¼€é”€ã€‚</p>

<p>MMAPv1å­˜å‚¨å¼•æ“ï¼Œç•¥ã€‚</p>

<p>ä¸ºäº†æä¾›é«˜å¯ç”¨æ€§è€Œå¯¹å†™æ“ä½œåšçš„æ—¥å¿—ä¹Ÿä¼šå¢åŠ å¼€é”€ï¼Œè¯¦ç•¥ã€‚</p>

<h4 id="explain-results">Explain Results*</h4>
<p>ç•¥ï¼Œç”¨åˆ°å†çœ‹ã€‚</p>

<h3 id="analyze-query-performance">Analyze Query Performance</h3>
<p>åˆ†ææŸ¥è¯¢ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// { "_id" : 1, "item" : "f1", type: "food", quantity: 500 }

db.inventory.find(
   { quantity: { $gte: 100, $lte: 200 } }
).explain("executionStats")
</code></pre></div></div>
<p>è¾“å‡ºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
   "queryPlanner" : {
         "plannerVersion" : 1,
         ...
         "winningPlan" : {
            "stage" : "COLLSCAN",  // COLLSCANè¯´æ˜æ‰§è¡Œäº†collection scan
            ...
         }
   },
   "executionStats" : {
      "executionSuccess" : true,
      "nReturned" : 3,  // åŒ¹é…åˆ°å¹¶è¿”å›äº†3æ¡è®°å½•
      "executionTimeMillis" : 0,
      "totalKeysExamined" : 0,
      "totalDocsExamined" : 10,  // scanäº†10æ¡è®°å½•
      "executionStages" : {
         "stage" : "COLLSCAN",   
         ...
      },
      ...
   },
   ...
}
</code></pre></div></div>

<p>åˆ›å»ºç´¢å¼•ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.createIndex( { quantity: 1 } )
</code></pre></div></div>
<p>winningPlançš„stageå˜ä¸ºIXSCANï¼ˆIndex Scanï¼‰ï¼ŒtotalDocsExaminedå˜ä¸º3ã€‚</p>

<h4 id="compare-performance-of-indexes">Compare Performance of Indexes</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.createIndex( { quantity: 1, type: 1 } )
db.inventory.createIndex( { type: 1, quantity: 1 } )

// ä½¿ç”¨hintè®¾ç½®è¦ä½¿ç”¨çš„ç´¢å¼•
db.inventory.find(
   { quantity: { $gte: 100, $lte: 300 }, type: "food" }
).hint({ quantity: 1, type: 1 }).explain("executionStats")
</code></pre></div></div>
<p>è¾“å‡ºï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
   "queryPlanner" : {
      ...
      "winningPlan" : {
         "stage" : "FETCH",
         "inputStage" : {
            "stage" : "IXSCAN",
            "keyPattern" : {
               "quantity" : 1,
               "type" : 1
            },
            ...
            }
         }
      },
      "rejectedPlans" : [ ]
   },
   "executionStats" : {
      "executionSuccess" : true,
      "nReturned" : 2,
      "executionTimeMillis" : 0,
      "totalKeysExamined" : 5,   // å…±æ‰«æäº†5ä¸ªç´¢å¼•
      "totalDocsExamined" : 2,
      "executionStages" : {
      ...
      }
   },
   ...
}
</code></pre></div></div>
<p>æ¢ä¸ªç´¢å¼•ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.inventory.find(
   { quantity: { $gte: 100, $lte: 300 }, type: "food" }
).hint({ type: 1, quantity: 1 }).explain("executionStats")
</code></pre></div></div>
<p>totalKeysExaminedçš„å€¼å˜ä¸º2ã€‚è¯´æ˜å¯¹äºè¯¥æŸ¥è¯¢ï¼Œæ˜¾ç„¶ç¬¬2ä¸ªç´¢å¼•æ•ˆç‡æ›´é«˜ã€‚</p>

<h3 id="tailable-cursors">Tailable Cursors</h3>
<p>å½“å†™æ“ä½œé‡æ¯”è¾ƒå¤§æ—¶ï¼Œé€šè¿‡å»ºç´¢å¼•æ¥æé«˜æŸ¥è¯¢æ•ˆç‡çš„åšæ³•æ˜¯ä¸å®é™…çš„ã€‚å¯¹äºCapped Collectionï¼Œå¯ä»¥ä½¿ç”¨tailable cursorsæ¥å®ç°tailæœ€æ–°æ’å…¥çš„è®°å½•ã€‚MongoDBçš„æ“ä½œæ—¥å¿—åŒæ­¥å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</p>

<p>å¯¹äºå»ºæœ‰ç´¢å¼•çš„collectionï¼Œåº”è¯¥ä½¿ç”¨å¸¸è§„çš„coursorï¼Œå¹¶è®°å½•æ¯æ¬¡æŸ¥è¯¢å¾—åˆ°çš„æœ€æ–°çš„ç´¢å¼•çš„å€¼ä»¥ä¾¿ä»¥åæŸ¥è¯¢ä½¿ç”¨ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.&lt;collection&gt;.find( { indexedField: { $gt: &lt;lastvalue&gt; } } )
</code></pre></div></div>

<h1 id="aggregation">Aggregation</h1>

<p>To be continueâ€¦</p>

:ET